# 【HPC简史】消息传递接口MPI诞生记

>方佳瑞
>
>2023-08-27
>
>https://zhuanlan.zhihu.com/p/652690336

自1946年人类第一台计算机艾尼阿克诞生后，机器代替人类进行计算成为可能。高性能数值计算的能力使得超级计算机能够处理复杂的计算任务，这是计算机领域中相当高深的学问。求解线性代数方程组为核心的数值计算应用广泛，它可以预测气象的风云变化，探测地下石油资源，模拟流体力学现象，以及预测新型药物的效果。而所有这些应用都离不开两个高性能计算的基础技术，即消息传递接口（MPI）和基本线性代数子程序库（BLAS）。

## 议大事豪杰再聚首，成小功英雄定约期

1992年4月29日至30日，弗吉尼亚州威廉斯堡正在召开一个研讨会。研讨会正式名称为“Workshop on Standards for Message Passing in a Distributed Memory Environment”，68名与会者分别来自欧洲、美国不同大学、政府实验室以及硬件和软件供应商。这个会议上，他们希望能赶快确定一套标准接口，规定分布式内存的计算机之间传递消息的规范。

20世纪80年代末和90年代初，随着计算机应用的复杂化和数据规模的增加，对高性能计算的需求不断增长。许多科学和工程领域的计算问题需要利用多个处理器并行执行，以提高计算速度和效率。然而，不同硬件厂商的通信接口各不相同，一套并行程序很难移至到其他机器上，这给开发人员造成了很大负担。威廉斯堡的会议正式要讨论标准消息传递接口所必需的基本特性，并成立了一个工作组推进其标准化进程。

一年前，关于统一消息传递接口的讨论曾经进行过一次。当时，与会者们起草了一份白皮书，概述了一个标准可能的样子。但是因为美国和欧洲对标准主导权存在一些分歧，没有得到实质性的落实。这次会议希望解决这些问题，尽快达成一致。29日下午会议正式开始，首先是美国的研究人员介绍了他们在这一领域的进展情况，紧接着是德国的研究人员介绍了欧洲的尝试。然后，每个单位的代表陆续作出报告。经过讨论环节，最后会议达成如下主要成果。

- 在高性能计算社区中广泛支持为分布式内存计算系统制定一套消息传递标准。
- 会议讨论了应该包含在这样一个标准中的重要组成部分，并强调了定义一个全球标准的必要性，而不仅仅是美国的标准。
- 在会议之后的1992年10月提出了一个初步接口标准的草案，被称为MPI（Message Passing Interface）。

30日晚上，会议总结由由杰克·唐加拉（Jack Dongarra）发表。这次会议的成功举办让他倍感兴奋。一方面，他自1989年开始就着手开展了PVM项目，在ORNL（橡树岭国家实验室）内部集群实现了机器互联的功能。MPI吸纳了了PVM的设计思想和经验。另一方面，他还在进行一个名为ScaLAPACK的分布式线性代数库项目，而这个项目也需要一套标准通信接口，使之变得容易移植。而他参与的一系列**线性代数库软件项目，让他获得了2021年的图灵奖**。

![img](https://pic1.zhimg.com/80/v2-2a86d5b5dca25d2957d34e2e0cee9580_720w.webp)

会议晚宴照片，中间是唐加拉

五个月后，还需要他来掌笔，定下MPI规范的初稿。那么，本次峰会的执牛耳者杰克·唐加拉是何许人也？要讲述这个故事，我们需要先从另一位图灵奖得主开始说起。

## 少才子竟承大师业，老博士苦读圣贤书

话说1970年的图灵奖授予了英国人威尔金森（James H. Wilkinson），以表彰他在计算机求解数据线性代数的贡献。威尔金森是的计算机科学祖师爷级别的人物。他是是个苏格兰人，就读于大名鼎鼎的剑桥大学三一学院数学系，并以最佳成绩毕业。三一学院是牛顿作为数学教授的地方，威尔金森是根红苗正的牛顿的传人。二战时候在剑桥用机器计算器计算炮弹轨迹，战后去了英国国家物理实验室（NPL）开展计算机相关工作。他在NPL的主管正是大名鼎鼎的阿兰.图灵。彼时，图灵在NPL领导一个叫自动计算机（Automatic Computing Engine，简称ACE）的项目。可是好景不长，图灵在NPL由于经费问题和实验室管理层发生分歧，孤身前往前往曼彻斯特大学任教去了。威尔金森顶替图灵被任命ACE项目负责人。他带领团队完成图灵设计的一个简化版本ACE Pilot，在1950年试运行成功。在Pilot ACE正式开幕式上，图灵也在，他拉着威尔金森手意味深长地说：你们现在取得的成绩比我留下来可能会更好。

![img](https://pic1.zhimg.com/80/v2-99ce1e9ecbb68518b2ca672be4333c9c_720w.webp)

威尔金森

在ACE项目中，威尔金森除了承担全面领导责任，还亲手焊了几块板子。尽管可以作为领导亲自参加研发工作的证明，也侧面可以看到让威尔金森耕耘硬件领域对他的数学才能着实有些浪费。也许对数值计算深厚兴趣使然，也许是看到了更大的创新和影响力机会，在ACE Pilot小牛试刀之后，威尔金森决定离开ACE项目，投身数值分析软件领域。威尔金森精通数学，加之过往软件硬件双修的经历让他如虎添翼。威尔金森撰写的论文迅速成为一股洪流，席卷了数值分析领域，使他很快成了现代数值分析领域的重要奠基人。1971年他参与出版了该领域集大成的著作《自动计算手册》（Handbook for Automatic Computation, Volume II, Linear Algebra），为从事科学计算和工程计算的研究人员和工程师提供了宝贵的参考和指南。

威尔金森在英国工作，但仍有远播其道的宏愿。70年代开始，威尔金森便定期去美国阿贡国家实验室访问。阿贡国家实验室位于芝加哥西南方25英里的一个森林保护区内。实验室周围自由漫游着一群白色鹿。该实验室主要为美国能源部进行基础科学、能源、交通、环境问题、计算和国家安全等方面的非机密研究项目。因为需要配置Algol编译器，阿贡实验室是为数不多具备编写《自动计算手册》中程序能力的地方。大约在1970年，阿贡实验室着手将《手册》的一部分翻译成Fortran，并研究随后的软件测试、分发和支持工作。

![img](https://pic2.zhimg.com/80/v2-7a41e299bfe9fd21a23f16f1b6ebfc81_720w.webp)

阿贡国家实验室周围的白鹿

有一次，威尔金森在阿贡实验室做学术报告，题目是“Improving the Accuracy of Computed Matrix Eigenvalues”。报告讲了一个叫EISPACK的项目，它是基于威尔金森的《手册》中思想开发的求解特征向量（Eigenvalue）的程序。这个工作立刻引起了台下一位年轻博士生的浓厚兴趣。他就是当时正在新墨西哥州立大学攻读博士学位的唐加拉。

唐加拉，美利坚芝加哥人士也。在来新墨西哥州之前，他分别在芝加哥州立大学取得学士学位，在伊利诺伊理工学院取得了硕士学位。他在硕士论文中开始进行了一些数值算法工作，在导师指导下将大型带状矩阵化简为三对角形式。这也使他获得了优化内存移动的经验。

![img](https://pic1.zhimg.com/80/v2-1bf7ba16edf4dd3e03076126382be06c_720w.webp)

年轻时的唐加拉

新墨西哥州立大学所在的新墨西哥州在美国南部沙漠包围之中，也就是是美剧绝命毒师的发生地。至于小唐为什么从四季分明的伊利诺伊老家来到干燥炎热的新墨西哥读书我们不得而知。不过唐加拉的博士导师克里夫·莫勒（Cleve Moler）可是一位响当当的大人物。莫勒博士毕业于斯坦福大学，在1970年代初，莫勒在新墨西哥大学任职期间，他创建了大名鼎鼎的MATLAB编程语言。不过，在那个时候想参与数学软件的开发，阿贡实验室是一个必访之地，因此唐加拉博士期间的大部分研究应该还是伊利诺伊州的阿岗实验室完成的。

莫勒看见徒弟唐加拉对威尔金森老爷子的工作十分痴迷，便让唐加拉以威尔金森的报告为博士论文题目开展研究。还推荐唐加拉去英国NPL找威尔金森当面请教。唐加拉受到《自动计算手册》启发开发了一系列最小二乘法求解线性方程组的fortran程序，也就是LINPACK项目。杰克的第一篇发表的论文与阿贡实验室同事一起完成，主题是Fortran中的循环展开，这标志着杰克对性能的关注开始。优化对象也是LINPACK中的点积等例程，LINPACK后来形成了level 1 BLAS库的基础。

这里有必要科普一下BLAS（Basic Linear Algebra Subprograms），它是一组用于执行基本线性代数运算的软件库。BLAS库中的函数被分为三个级别（Level 1、Level 2和Level 3），Level 1 BLAS包含了向量操作，例如向量的加法、减法、点积等计算。Level 2 BLAS包含了矩阵-向量操作，例如矩阵与向量的乘法或解线性方程组。Level 2 BLAS函数通常用于执行矩阵与向量之间的乘法、解线性方程组等操作。Level 3 BLAS包含了矩阵-矩阵操作，例如矩阵与矩阵的乘法。

唐加拉1973年硕士毕业，可是等到他博士毕业已经是1980年了。七年博士，在新墨西哥大学应该是比较漫长的了。那唐加拉毕业之后何去何从呢？请听下回分解。

## 发文章师徒同登台，著软件同行襄盛举

1980年，唐加拉博士毕业，毕业论文题目正是《Improving the Accuracy of Computed Matrix Eigenvalues》，也就是当年威尔金森的报告题目，后来这篇博士论文也发表在注明期刊Society for Industrial and Applied Mathematics(SIAM)上，威尔金森是合作作者之一。尽管没有法律意义的师生关系，威尔金森一直被唐加拉奉为博士导师之一。

唐加拉博士毕业后继续在阿贡国家实验室做数值计算的研究。唐加拉意识到在数值线性代数算法中，除了向量级别的的Level 1 BLAS，还需要矩阵层面的优化操作。因此，他把目标瞄准了Level 2/3 BLAS的优化。EISPACK和LINPACK并没有用Level 2或Level 3 BLAS来表达。这促使了LAPACK项目的启动，由唐加拉和伯克利的Jame Demmel领导，集合了开源社区各路势力，该项目产生了一个新BLAS库。LAPACK采用分块算法来确保高水平的数据重用；这些算法包括新的算法（如分而治之的特征值算法）以及将现有算法重新表达为Level 2和Level 3 BLAS的能力。LAPACK的首次公开发布是在1992年2月29日，之后它被以软件包和库的形式提供使用。例如，NAG和MATLAB都封装了它们，芯片制造商AMD、ARM和Intel的BLAS库也封装了它们。LAPACK已经是许多应用软件包的核心，因此它必定拥有数百万用户，其中许多人可能并不知道他们在使用LAPACK。

![img](https://pic1.zhimg.com/80/v2-4a380f700fc781e0b52439b2dfaf4c94_720w.webp)

LAPACK Software Group，中右唐加拉

时间进入90年代，随着大型机的发展，唐加拉开始关注如何在多个机器上并行完成BLAS运算。ScaLAPACK（Scalable Linear Algebra PACKage）项目应运而生，它的目标是为分布式内存并行机器开发一种LAPACK的版本。简单来说，它是一个并行版本的BLAS，该项目的一个关键是开发一个消息传递库，时间不同计算节点之间的数据传递。

最开始，唐加拉领导同事们开发了一个名为PVM（Parallel Virtual Machine）项目。它最早开始于1989年夏天，PVM是一套并行计算工具软件，可以在多种体系结构的计算机上运行，包括工作站、并行机以及向量机等。PVM还支持应用程序、机器以及网络级的异构性，允许应用任务选择最适合它进行计算的结点。如果两台机器的数据表示格式不同，PVM可以自动解决数据转换的问题，并且允许虚拟机使用多种不同的网络进行互连。在PVM系统中，机器之间的通信基于TCP/IP协议，同时也支持多处理机内部结点直接利用多处理机本身提供的通信函数。

![img](https://pic4.zhimg.com/80/v2-411a05a81695097f937c0eaeabac118f_720w.webp)

唐加拉PPT中对PVM和MPI调侃的图片

PVM的功能其实非常强大，你甚至可以动态地更改使用的处理器数量。但是，与PVM同时期，也有很多其他类似的通信库。比如橡树岭实验室的PICL（Portable Instrumented Communication Library），GMD的PARMACS，等等。这样唐加拉意识到，每个现有系统都有优点，但没有一个系统具备推动应用程序开发所需的一切，必须发起一个社区努力来解决这个问题。因为对LAPACK的突出贡献，唐加拉在HPC领域江湖地位日益突出。因此，集合欧美各方HPC势力的研讨会也是由他牵头张罗，便有了本文开头提到了威廉斯堡研讨会。

## 大人物趁热定草案，新规范日后显神威

基于4月会议精神，唐加拉和托尼·海（Tony Hey）和大卫·沃克（David W. Walker）三位欧美HPC领域大佬于1992年11月提出了初步的草案提案“MPI 1”。草案中MPI的接口已经初见雏形，但是和现在有很大不同。MPI工作组在1993年的头9个月内每6周举行一次会议。MPI草案标准于1993年11月在Supercomputing 93’会议上进行了介绍。经过一段公示期，在此期间MPI进行了一些修改，MPI的1.0版本于1994年6月发布。这个版本已经确定了如Bcast，all-gather，all-to-all等基本的操作单元。

MPI只是一个规范，具体实现方式大家可以自作主张。借助开源社区群策群力，MPI有很多开源实现的版本，比如[Open MPI](https://link.zhihu.com/?target=https%3A//www.open-mpi.org/)，[MVAPICH](https://link.zhihu.com/?target=https%3A//mvapich.cse.ohio-state.edu/)，[MPICH](https://link.zhihu.com/?target=https%3A//www.mpich.org/)等。也有硬件厂商的私有版本，比如Intel，AMD都有自己的私有MPI实现。和LAPACK一样，MPI渗透到了并行计算软件的方方面面。

预知MPI后续的发展历程，请听下回分解。

## 参考

[The Influence and Contribution of Jack Dongarra to Numerical Linear Algebra:](https://link.zhihu.com/?target=https%3A//hammarling.com/sven/pubs/HaHi22_Final.pdf)

[MPI 25 years](https://link.zhihu.com/?target=https%3A//www.mcs.anl.gov/mpi-symposium/slides/jack_dongarra_25yrsmpi.pdf)

[Improve the accuracy of the computed matrix eigenvalues](https://link.zhihu.com/?target=https%3A//www.osti.gov/servlets/purl/5047973)

[Jim Hardy Wilkinson](https://link.zhihu.com/?target=https%3A//blogs.mathworks.com/cleve/2013/02/18/jim-wilkinson/)

[PVM](https://link.zhihu.com/?target=https%3A//citeseerx.ist.psu.edu/document%3Frepid%3Drep1%26type%3Dpdf%26doi%3Da2c517809dfb91d29e17e663d8653304b5616e80)